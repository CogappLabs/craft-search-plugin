{# Minimal frontend Sprig search component. #}

{% macro hiddenState(ctx) %}
    <input type="hidden" name="indexHandle" value="{{ ctx.indexHandle }}">
    <input type="hidden" name="doSearch" value="1">
    <input type="hidden" name="showRaw" value="{{ ctx.showRaw ? 1 : 0 }}">
    <input type="hidden" name="showRoleDebug" value="{{ ctx.showRoleDebug ? 1 : 0 }}">
    {% if ctx.page is defined %}<input type="hidden" name="page" value="{{ ctx.page }}">{% endif %}
    {% if ctx.query is defined %}<input type="hidden" name="query" value="{{ ctx.query }}">{% endif %}
    {% if ctx.perPage is defined %}<input type="hidden" name="perPage" value="{{ ctx.perPage }}">{% endif %}
    {% if ctx.sortField is defined %}<input type="hidden" name="sortField" value="{{ ctx.sortField }}">{% endif %}
    {% if ctx.sortDirection is defined %}<input type="hidden" name="sortDirection" value="{{ ctx.sortDirection }}">{% endif %}
    {% for facetField in ctx.facetFields ?? [] %}
        <input type="hidden" name="facetFields[]" value="{{ facetField }}">
    {% endfor %}
    {% for fieldName, fieldValues in ctx.filters ?? {} %}
        {% if fieldValues is iterable and (fieldValues.min is defined or fieldValues.max is defined) %}
            {% if fieldValues.min is defined %}<input type="hidden" name="filters[{{ fieldName }}][min]" value="{{ fieldValues.min }}">{% endif %}
            {% if fieldValues.max is defined %}<input type="hidden" name="filters[{{ fieldName }}][max]" value="{{ fieldValues.max }}">{% endif %}
        {% else %}
            {% for fieldValue in fieldValues %}
                <input type="hidden" name="filters[{{ fieldName }}][]" value="{{ fieldValue }}">
            {% endfor %}
        {% endif %}
    {% endfor %}
{% endmacro %}

{% set showRawEnabled = siToBool(showRaw) %}
{% set showRoleDebugEnabled = siToBool(showRoleDebug) %}
{% set autoSearchEnabled = siToBool(autoSearch) %}
{% set hideSubmitEnabled = siToBool(hideSubmit) %}
{% set idPrefix = idPrefix ?? 'si-search' %}
{% set queryId = idPrefix ~ '-query' %}
{% set perPageId = idPrefix ~ '-perpage' %}
{% set sortFieldId = idPrefix ~ '-sortfield' %}
{% set sortDirectionId = idPrefix ~ '-sortdirection' %}
{% set formTrigger = autoSearchEnabled ? "submit, keyup changed delay:300ms from:input[name='query'], change from:input[name='perPage'], change from:select[name='sortField'], change from:select[name='sortDirection']" : 'submit' %}
{% set totalPages = data and data.success ? (data.totalPages ?? 0) : 0 %}
{% set currentPage = data and data.success ? (data.page ?? page) : page %}
{% set roleFields = {} %}
{% set indexModel = craft.searchIndex.index(indexHandle) %}
{% if indexModel %}
    {% for mapping in indexModel.getFieldMappings() %}
        {% if mapping.enabled and mapping.role %}
            {% set roleFields = roleFields|merge({ (mapping.role): mapping.indexFieldName }) %}
        {% endif %}
    {% endfor %}
{% endif %}
{% set titleField = roleFields.title ?? null %}
{% set summaryField = roleFields.summary ?? null %}
{% set urlField = roleFields.url ?? null %}
{% set imageField = roleFields.image ?? null %}

<div class="si-default-search-box">
    <form
        sprig
        s-method="post"
        s-trigger="{{ formTrigger }}"
        s-swap="outerHTML transition:true"
        s-target="closest .si-default-search-box"
        class="flex flex-wrap items-end gap-3"
    >
        {{ _self.hiddenState({ indexHandle, showRaw, showRoleDebug, page: 1, facetFields, filters }) }}

        <label class="flex flex-col gap-1 text-sm text-gray-600">
            <span>{{ 'Search'|t('search-index') }}</span>
            <input
                id="{{ queryId }}"
                type="text"
                name="query"
                value="{{ query }}"
                placeholder="{{ 'Type and press enter'|t('search-index') }}"
                class="border border-gray-300 rounded px-3 py-1.5 text-sm text-gray-900 w-64"
            >
        </label>

        <label class="flex flex-col gap-1 text-sm text-gray-600">
            <span>{{ 'Per page'|t('search-index') }}</span>
            <input id="{{ perPageId }}" type="number" name="perPage" value="{{ perPage }}" min="1" max="50" class="border border-gray-300 rounded px-3 py-1.5 text-sm text-gray-900 w-20">
        </label>

        <label class="flex flex-col gap-1 text-sm text-gray-600">
            <span>{{ 'Sort by'|t('search-index') }}</span>
            <select id="{{ sortFieldId }}" name="sortField" class="border border-gray-300 rounded px-3 py-1.5 text-sm text-gray-900">
                {% for option in sortOptions %}
                    <option value="{{ option.value }}"{% if option.value == sortField %} selected{% endif %}>{{ option.label }}</option>
                {% endfor %}
            </select>
        </label>

        <label class="flex flex-col gap-1 text-sm text-gray-600">
            <span>{{ 'Direction'|t('search-index') }}</span>
            <select id="{{ sortDirectionId }}" name="sortDirection" class="border border-gray-300 rounded px-3 py-1.5 text-sm text-gray-900">
                <option value="asc"{% if sortDirection == 'asc' %} selected{% endif %}>{{ 'Asc'|t('search-index') }}</option>
                <option value="desc"{% if sortDirection != 'asc' %} selected{% endif %}>{{ 'Desc'|t('search-index') }}</option>
            </select>
        </label>

        {% if not hideSubmitEnabled %}
            <button type="submit" class="bg-gray-900 text-white px-4 py-1.5 rounded text-sm hover:bg-gray-700 transition-colors cursor-pointer">{{ 'Search'|t('search-index') }}</button>
        {% endif %}
        <span class="htmx-indicator text-sm text-gray-600" role="status">{{ 'Searching…'|t('search-index') }}</span>
    </form>

    {% if doSearch and filters|length %}
        <div class="mt-3 flex flex-wrap items-center gap-2 text-sm">
            {% for fieldName, fieldValues in filters %}
                {% if fieldValues is iterable and (fieldValues.min is defined or fieldValues.max is defined) %}
                    {# Range filter chip #}
                    <form style="display:inline;margin:0;padding:0">
                        {{ _self.hiddenState({ indexHandle, showRaw, showRoleDebug, query, perPage, sortField, sortDirection, page: 1, facetFields }) }}
                        {# Preserve other filters but omit this range filter #}
                        {% for otherField, otherValues in filters|filter((v, k) => k != fieldName) %}
                            {% if otherValues is iterable and (otherValues.min is defined or otherValues.max is defined) %}
                                {% if otherValues.min is defined %}<input type="hidden" name="filters[{{ otherField }}][min]" value="{{ otherValues.min }}">{% endif %}
                                {% if otherValues.max is defined %}<input type="hidden" name="filters[{{ otherField }}][max]" value="{{ otherValues.max }}">{% endif %}
                            {% else %}
                                {% for ov in otherValues %}
                                    <input type="hidden" name="filters[{{ otherField }}][]" value="{{ ov }}">
                                {% endfor %}
                            {% endif %}
                        {% endfor %}
                        <button
                            sprig
                            type="button"
                            s-method="post"
                            s-include="closest form"
                            s-swap="outerHTML transition:true"
                            s-target="closest .si-default-search-box"
                            class="inline-flex items-center gap-1 px-2.5 py-1 rounded-full bg-gray-200 text-gray-700 text-xs cursor-pointer border-0 hover:bg-gray-300"
                            aria-label="{{ 'Remove filter {field}: {min} – {max}'|t('search-index', { field: fieldName, min: fieldValues.min ?? '…', max: fieldValues.max ?? '…' }) }}"
                        >
                            {{ fieldName }}: {{ fieldValues.min ?? '…' }} &ndash; {{ fieldValues.max ?? '…' }} <span aria-hidden="true">&times;</span>
                        </button>
                    </form>
                {% else %}
                    {% for value in fieldValues %}
                        {% set remaining = fieldValues|filter(v => v != value) %}
                        <form style="display:inline;margin:0;padding:0">
                            {{ _self.hiddenState({ indexHandle, showRaw, showRoleDebug, query, perPage, sortField, sortDirection, page: 1, facetFields }) }}
                            <input type="hidden" name="siFacetField" value="{{ fieldName }}">
                            {% for rv in remaining %}
                                <input type="hidden" name="siFacetValues[]" value="{{ rv }}">
                            {% endfor %}
                            {% for otherField, otherValues in filters|filter((v, k) => k != fieldName) %}
                                {% if otherValues is iterable and (otherValues.min is defined or otherValues.max is defined) %}
                                    {% if otherValues.min is defined %}<input type="hidden" name="filters[{{ otherField }}][min]" value="{{ otherValues.min }}">{% endif %}
                                    {% if otherValues.max is defined %}<input type="hidden" name="filters[{{ otherField }}][max]" value="{{ otherValues.max }}">{% endif %}
                                {% else %}
                                    {% for ov in otherValues %}
                                        <input type="hidden" name="filters[{{ otherField }}][]" value="{{ ov }}">
                                    {% endfor %}
                                {% endif %}
                            {% endfor %}
                            <button
                                sprig
                                type="button"
                                s-method="post"
                                s-include="closest form"
                                s-swap="outerHTML transition:true"
                                s-target="closest .si-default-search-box"
                                class="inline-flex items-center gap-1 px-2.5 py-1 rounded-full bg-gray-200 text-gray-700 text-xs cursor-pointer border-0 hover:bg-gray-300"
                                aria-label="{{ 'Remove filter {field}: {value}'|t('search-index', { field: fieldName, value: value }) }}"
                            >
                                {{ value }} <span aria-hidden="true">&times;</span>
                            </button>
                        </form>
                    {% endfor %}
                {% endif %}
            {% endfor %}
            <form style="display:inline;margin:0;padding:0">
                {{ _self.hiddenState({ indexHandle, showRaw, showRoleDebug, query, perPage, sortField, sortDirection, page: 1, facetFields }) }}
                <button
                    sprig
                    type="button"
                    s-method="post"
                    s-include="closest form"
                    s-swap="outerHTML transition:true"
                    s-target="closest .si-default-search-box"
                    class="px-2.5 py-1 rounded-full border border-gray-300 text-gray-600 text-xs hover:bg-gray-100 cursor-pointer"
                >{{ 'Clear all'|t('search-index') }}</button>
            </form>
        </div>
    {% endif %}

    {% if doSearch %}
        {% if not data or not data.success %}
            <p class="text-sm text-red-600 mt-4">{{ data.message ?? 'Search failed.'|t('search-index') }}</p>
        {% elseif not data.hits or data.hits|length == 0 %}
            <p class="text-sm text-gray-600 mt-4">{{ 'No results found.'|t('search-index') }}</p>
        {% else %}
            <p class="text-sm text-gray-600 mt-4">
                {{ '{total} results in {time}ms'|t('search-index', {
                    total: data.totalHits,
                    time: data.processingTimeMs,
                }) }}
            </p>

            <ul class="list-none m-0 p-0 grid gap-4 grid-cols-[repeat(auto-fill,minmax(220px,1fr))] mt-4">
                {% for hit in data.hits %}
                    {% set hitKeys = hit|keys %}
                    {% set titleRoleValue = titleField and titleField in hitKeys ? attribute(hit, titleField) : null %}
                    {% set summaryRoleValue = summaryField and summaryField in hitKeys ? attribute(hit, summaryField) : null %}
                    {% set urlRoleValue = urlField and urlField in hitKeys ? attribute(hit, urlField) : null %}
                    {% set imageRoleValue = imageField and imageField in hitKeys ? attribute(hit, imageField) : null %}
                    {% set title = titleRoleValue ?? hit.title ?? hit.name ?? hit.objectID ?? '-' %}
                    {% set summary = summaryRoleValue %}
                    {% set rawUrl = urlRoleValue %}
                    {% set rawUrl = rawUrl ?? hit.url ?? hit.uri ?? null %}
                    {% set imageValue = imageRoleValue %}
                    {% set resultUrl = null %}
                    {% set imageUrl = null %}
                    {% set imageWidth = 240 %}
                    {% set imageHeight = 150 %}
                    {% if rawUrl %}
                        {% if rawUrl is string and (rawUrl starts with 'http://' or rawUrl starts with 'https://') %}
                            {% set resultUrl = rawUrl %}
                        {% elseif rawUrl is string and rawUrl starts with '/' %}
                            {% set resultUrl = siteUrl(rawUrl|trim('/')) %}
                        {% endif %}
                    {% endif %}
                    {% if imageValue %}
                        {% if imageValue is numeric %}
                            {% set imageAsset = craft.assets.id(imageValue|integer).one() %}
                            {% if imageAsset %}
                                {% set imageUrl = imageAsset.getUrl({
                                    width: imageWidth,
                                    height: imageHeight,
                                    mode: 'crop',
                                }) %}
                            {% endif %}
                        {% elseif imageValue is string and (imageValue starts with 'http://' or imageValue starts with 'https://') %}
                            {% set imageUrl = imageValue %}
                        {% elseif imageValue is string and imageValue starts with '/' %}
                            {% set imageUrl = siteUrl(imageValue|trim('/')) %}
                        {% endif %}
                    {% endif %}

                    <li class="border border-gray-200 rounded-lg overflow-hidden">
                        {% if imageUrl %}
                            <img src="{{ imageUrl }}" alt="" loading="lazy" width="{{ imageWidth }}" height="{{ imageHeight }}" class="block w-full h-auto">
                        {% endif %}

                        <div class="p-3">
                            {% if resultUrl %}
                                <h3 class="text-sm font-semibold m-0"><a href="{{ resultUrl }}" class="text-gray-900 hover:text-blue-600">{{ title }}</a></h3>
                            {% else %}
                                <h3 class="text-sm font-semibold m-0">{{ title }}</h3>
                            {% endif %}

                            {% if summary %}
                                <p class="text-xs text-gray-600 mt-1 m-0 line-clamp-2">{{ summary }}</p>
                            {% endif %}

                            {% if hit.objectID is defined %}
                                <p class="text-[10px] text-gray-600 mt-1 m-0">ID: {{ hit.objectID }}</p>
                            {% endif %}

                            {% if showRoleDebugEnabled %}
                                <div class="mt-2 pt-2 border-t border-gray-100 text-[10px] text-gray-600 space-y-0.5">
                                    {% if titleField %}
                                        {% set titleRoleDisplay = titleRoleValue is iterable ? titleRoleValue|json_encode : (titleRoleValue ?? 'null') %}
                                        <div>title (<code>{{ titleField }}</code>): {{ titleRoleDisplay }}</div>
                                    {% endif %}
                                    {% if summaryField %}
                                        {% set summaryRoleDisplay = summaryRoleValue is iterable ? summaryRoleValue|json_encode : (summaryRoleValue ?? 'null') %}
                                        <div>summary (<code>{{ summaryField }}</code>): {{ summaryRoleDisplay }}</div>
                                    {% endif %}
                                    {% if urlField %}
                                        {% set urlRoleDisplay = urlRoleValue is iterable ? urlRoleValue|json_encode : (urlRoleValue ?? 'null') %}
                                        <div>url (<code>{{ urlField }}</code>): {{ urlRoleDisplay }}</div>
                                    {% endif %}
                                    {% if imageField %}
                                        {% set imageRoleDisplay = imageRoleValue is iterable ? imageRoleValue|json_encode : (imageRoleValue ?? 'null') %}
                                        <div>image (<code>{{ imageField }}</code>): {{ imageRoleDisplay }}</div>
                                    {% endif %}
                                    {% if not imageUrl and imageField %}
                                        <div class="text-amber-500">No renderable image URL found.</div>
                                    {% endif %}
                                </div>
                            {% endif %}
                        </div>
                    </li>
                {% endfor %}
            </ul>

            {% if data.facets is defined and data.facets %}
                <div class="mt-6">
                    <h3 class="text-sm font-semibold mb-3">{{ 'Facets'|t('search-index') }}</h3>
                    <div class="flex flex-wrap gap-6">
                        {% for fieldName, facetItems in data.facets %}
                            <fieldset class="border-0 m-0 p-0">
                                <legend class="text-xs text-gray-600 mb-1">{{ fieldName }}</legend>
                                <form class="flex flex-col gap-1">
                                    <input type="hidden" name="siFacetField" value="{{ fieldName }}">
                                    {{ _self.hiddenState({ indexHandle, showRaw, showRoleDebug, query, perPage, sortField, sortDirection, page: 1, facetFields }) }}
                                    {# Pass other facet filters through unchanged #}
                                    {% for otherField, otherValues in filters|filter((v, k) => k != fieldName) %}
                                        {% if otherValues is iterable and (otherValues.min is defined or otherValues.max is defined) %}
                                            {% if otherValues.min is defined %}<input type="hidden" name="filters[{{ otherField }}][min]" value="{{ otherValues.min }}">{% endif %}
                                            {% if otherValues.max is defined %}<input type="hidden" name="filters[{{ otherField }}][max]" value="{{ otherValues.max }}">{% endif %}
                                        {% else %}
                                            {% for v in otherValues %}
                                                <input type="hidden" name="filters[{{ otherField }}][]" value="{{ v }}">
                                            {% endfor %}
                                        {% endif %}
                                    {% endfor %}

                                    {% for item in facetItems %}
                                        {% set checked = item.value in (filters[fieldName] ?? []) %}
                                        <label class="flex items-center gap-1.5 text-xs text-gray-700 cursor-pointer">
                                            <input
                                                type="checkbox"
                                                name="siFacetValues[]"
                                                value="{{ item.value }}"
                                                {% if checked %}checked{% endif %}
                                                sprig
                                                s-method="post"
                                                s-trigger="change"
                                                s-include="closest form"
                                                s-swap="outerHTML transition:true"
                                                s-target="closest .si-default-search-box"
                                                class="accent-gray-700"
                                            >
                                            {{ item.value }} ({{ item.count }})
                                        </label>
                                    {% endfor %}

                                    <span class="htmx-indicator text-xs text-gray-600" role="status">{{ 'Applying…'|t('search-index') }}</span>
                                </form>
                            </fieldset>
                        {% endfor %}
                    </div>
                </div>
            {% endif %}

            {# Range filters for numeric fields #}
            {% set stats = data.stats ?? {} %}
            {% set histograms = data.histograms ?? {} %}
            {% if numericFields|length and stats %}
                <div class="mt-6">
                    <h3 class="text-sm font-semibold mb-3">{{ 'Range Filters'|t('search-index') }}</h3>
                    <div class="flex flex-wrap gap-6">
                        {% for fieldName in numericFields %}
                            {% set fieldStats = stats[fieldName] ?? {} %}
                            {% set currentRange = filters[fieldName] ?? {} %}
                            {% set fieldHistogram = histograms[fieldName] ?? [] %}
                            <fieldset class="border-0 m-0 p-0">
                                <legend class="text-xs text-gray-600 mb-1">{{ fieldName }}</legend>
                                <form class="flex flex-col gap-2">
                                    {{ _self.hiddenState({ indexHandle, showRaw, showRoleDebug, query, perPage, sortField, sortDirection, page: 1, facetFields }) }}
                                    {# Preserve other filters #}
                                    {% for otherField, otherValues in filters|filter((v, k) => k != fieldName) %}
                                        {% if otherValues is iterable and (otherValues.min is defined or otherValues.max is defined) %}
                                            {% if otherValues.min is defined %}<input type="hidden" name="filters[{{ otherField }}][min]" value="{{ otherValues.min }}">{% endif %}
                                            {% if otherValues.max is defined %}<input type="hidden" name="filters[{{ otherField }}][max]" value="{{ otherValues.max }}">{% endif %}
                                        {% else %}
                                            {% for v in otherValues %}
                                                <input type="hidden" name="filters[{{ otherField }}][]" value="{{ v }}">
                                            {% endfor %}
                                        {% endif %}
                                    {% endfor %}
                                    <div class="flex gap-2 items-center">
                                        <input
                                            id="{{ idPrefix }}-range-min-{{ fieldName }}"
                                            type="number"
                                            name="filters[{{ fieldName }}][min]"
                                            value="{{ currentRange.min ?? '' }}"
                                            placeholder="{{ fieldStats.min is defined ? fieldStats.min : 'Min' }}"
                                            step="any"
                                            class="border border-gray-300 rounded px-2 py-1 text-xs w-24"
                                        >
                                        <span class="text-gray-600 text-xs">&ndash;</span>
                                        <input
                                            id="{{ idPrefix }}-range-max-{{ fieldName }}"
                                            type="number"
                                            name="filters[{{ fieldName }}][max]"
                                            value="{{ currentRange.max ?? '' }}"
                                            placeholder="{{ fieldStats.max is defined ? fieldStats.max : 'Max' }}"
                                            step="any"
                                            class="border border-gray-300 rounded px-2 py-1 text-xs w-24"
                                        >
                                    </div>
                                    <button
                                        sprig
                                        id="{{ idPrefix }}-range-apply-{{ fieldName }}"
                                        type="button"
                                        s-method="post"
                                        s-include="closest form"
                                        s-swap="outerHTML transition:true"
                                        s-target="closest .si-default-search-box"
                                        class="px-2.5 py-1 text-xs rounded border border-gray-300 text-gray-700 hover:bg-gray-100 cursor-pointer self-start"
                                    >
                                        {{ 'Apply'|t('search-index') }}
                                    </button>
                                    {% if fieldHistogram|length %}
                                        <button type="button"
                                            class="si-histogram-trigger flex items-center justify-center gap-1.5 px-2.5 py-1 text-xs rounded border border-gray-300 text-gray-600 hover:bg-gray-100 cursor-pointer w-full"
                                            data-histogram="{{ fieldHistogram|json_encode }}"
                                            data-stats="{{ fieldStats|json_encode }}"
                                            data-field="{{ fieldName }}"
                                            data-dialog-id="{{ idPrefix }}-histogram-dialog-{{ fieldName }}"
                                        >
                                            <svg width="12" height="10" viewBox="0 0 14 12" fill="currentColor"><rect x="0" y="6" width="3" height="6" opacity=".5"/><rect x="4" y="2" width="3" height="10"/><rect x="8" y="4" width="3" height="8" opacity=".7"/><rect x="12" y="8" width="2" height="4" opacity=".3"/></svg>
                                            {{ 'distribution'|t('search-index') }}
                                        </button>
                                    {% endif %}
                                </form>
                                {# Histogram modal #}
                                {% if fieldHistogram|length %}
                                    <dialog id="{{ idPrefix }}-histogram-dialog-{{ fieldName }}" style="max-width:600px;width:90vw;border:1px solid #cbd5e1;border-radius:8px;padding:0;background:#fff;box-shadow:0 25px 50px -12px rgba(0,0,0,.25);margin:auto;">
                                        <div style="padding:1.5rem;">
                                            <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:1rem;">
                                                <strong style="font-size:0.875rem;color:#334155;">{{ fieldName }} distribution</strong>
                                                <button type="button" class="si-histogram-close" style="background:none;border:none;font-size:1.25rem;cursor:pointer;color:#4b5563;padding:0.25rem;" aria-label="Close">&times;</button>
                                            </div>
                                            <svg style="width:100%;height:auto;"></svg>
                                            <div style="display:flex;gap:1rem;margin:1rem 0;align-items:center;">
                                                <label style="flex:1;font-size:0.75rem;color:#4b5563;">Min <input type="number" class="si-histogram-min" value="{{ currentRange.min ?? '' }}" placeholder="{{ fieldStats.min ?? '' }}" step="any" style="width:100%;margin-top:0.25rem;padding:0.25rem 0.5rem;font-size:0.75rem;border:1px solid #cbd5e1;border-radius:4px;"></label>
                                                <label style="flex:1;font-size:0.75rem;color:#4b5563;">Max <input type="number" class="si-histogram-max" value="{{ currentRange.max ?? '' }}" placeholder="{{ fieldStats.max ?? '' }}" step="any" style="width:100%;margin-top:0.25rem;padding:0.25rem 0.5rem;font-size:0.75rem;border:1px solid #cbd5e1;border-radius:4px;"></label>
                                            </div>
                                            <button type="button" class="si-histogram-apply"
                                                data-min-target="{{ idPrefix }}-range-min-{{ fieldName }}"
                                                data-max-target="{{ idPrefix }}-range-max-{{ fieldName }}"
                                                data-apply-target="{{ idPrefix }}-range-apply-{{ fieldName }}"
                                                style="display:block;width:100%;padding:4px 12px;font-size:0.75rem;text-transform:lowercase;text-align:center;background:transparent;color:#4b5563;border:1px solid #94a3b8;cursor:pointer;">apply</button>
                                        </div>
                                    </dialog>
                                {% endif %}
                            </fieldset>
                        {% endfor %}
                    </div>
                </div>
            {% endif %}

            {% if totalPages > 1 %}
                <form sprig s-method="post" s-trigger="submit" s-swap="outerHTML transition:true" s-target="closest .si-default-search-box" class="mt-6">
                    {{ _self.hiddenState({ indexHandle, showRaw, showRoleDebug, query, perPage, sortField, sortDirection, facetFields, filters }) }}

                    <nav aria-label="{{ 'Pagination'|t('search-index') }}" class="flex items-center gap-1">
                        {% if currentPage > 1 %}
                            <button type="submit" name="page" value="{{ currentPage - 1 }}" class="px-2.5 py-1 text-xs rounded border border-gray-300 text-gray-700 hover:bg-gray-100 cursor-pointer">{{ 'Previous'|t('search-index') }}</button>
                        {% endif %}

                        {% set _window = 5 %}
                        {% set _startPage = max(1, currentPage - _window) %}
                        {% set _endPage = min(totalPages, currentPage + _window) %}

                        {% if _startPage > 1 %}
                            <button type="submit" name="page" value="1" class="px-2.5 py-1 text-xs rounded border border-gray-300 text-gray-700 hover:bg-gray-100 cursor-pointer">1</button>
                            {% if _startPage > 2 %}<span class="text-gray-600 text-xs" aria-hidden="true">&hellip;</span>{% endif %}
                        {% endif %}

                        {% for p in _startPage.._endPage %}
                            <button type="submit" name="page" value="{{ p }}"{% if p == currentPage %} disabled aria-current="page"{% endif %} class="px-2.5 py-1 text-xs rounded border cursor-pointer {{ p == currentPage ? 'bg-gray-900 text-white border-gray-900' : 'border-gray-300 text-gray-700 hover:bg-gray-100' }}">{{ p }}</button>
                        {% endfor %}

                        {% if _endPage < totalPages %}
                            {% if _endPage < totalPages - 1 %}<span class="text-gray-600 text-xs" aria-hidden="true">&hellip;</span>{% endif %}
                            <button type="submit" name="page" value="{{ totalPages }}" class="px-2.5 py-1 text-xs rounded border border-gray-300 text-gray-700 hover:bg-gray-100 cursor-pointer">{{ totalPages }}</button>
                        {% endif %}

                        {% if currentPage < totalPages %}
                            <button type="submit" name="page" value="{{ currentPage + 1 }}" class="px-2.5 py-1 text-xs rounded border border-gray-300 text-gray-700 hover:bg-gray-100 cursor-pointer">{{ 'Next'|t('search-index') }}</button>
                        {% endif %}
                    </nav>
                </form>
            {% endif %}

            {% if showRawEnabled and data.raw %}
                <details class="mt-6">
                    <summary class="text-xs text-gray-600 cursor-pointer">{{ 'Raw response'|t('search-index') }}</summary>
                    <pre class="mt-2 text-[10px] bg-gray-50 p-3 rounded overflow-x-auto" tabindex="0">{{ data.raw|json_encode(constant('JSON_PRETTY_PRINT') b-or constant('JSON_UNESCAPED_SLASHES')) }}</pre>
                </details>
            {% endif %}
        {% endif %}
    {% endif %}
</div>
