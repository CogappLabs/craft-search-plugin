{# Sprig component: test engine connection. #}
{# Variables: engineType (string), engineConfig (array), _run (bool) #}

{% if not _run %}
    <button sprig type="button" class="btn" id="test-connection-btn"
        s-val:_run="1"
        s-include="#engineType, #engine-config"
    >{{ "Test Connection"|t('search-index') }}</button>
    <span class="ml-s" id="test-connection-result"></span>
{% else %}
    <button sprig type="button" class="btn" id="test-connection-btn"
        s-val:_run="1"
        s-include="#engineType, #engine-config"
    >{{ "Test Connection"|t('search-index') }}</button>

    {% if not engineType %}
        <span class="ml-s error">{{ 'Please select an engine first.'|t('search-index') }}</span>
    {% else %}
        {% set result = craft.searchIndex.testConnection(engineType, engineConfig ?? {}) %}

        {% if result.success %}
            <span class="ml-s success">{{ result.message }}</span>
        {% else %}
            <span class="ml-s error">{{ result.message }}</span>
        {% endif %}
    {% endif %}
{% endif %}
