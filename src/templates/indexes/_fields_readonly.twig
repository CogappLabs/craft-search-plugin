{% import "_includes/forms" as forms %}

{% do view.registerAssetBundle("cogapp\\searchindex\\web\\assets\\fieldmappings\\FieldMappingsAsset") %}

{{ hiddenInput('indexId', index.id) }}

<p class="light">{{ 'help.thisIsAReadOnlyIndexAssignRolesToSchemaFieldsSoTwigHelpersLikeGettitleGetsummaryEtcWorkWithDocumentsFromThisIndex'|t('search-index') }}</p>

{% if mappings|length %}
    <table class="data fullwidth" id="si-field-mappings">
        <thead>
            <tr>
                <th>{{ 'labels.indexField'|t('search-index') }}</th>
                <th>{{ 'labels.indexType'|t('search-index') }}</th>
                <th>{{ 'labels.role'|t('search-index') }}</th>
            </tr>
        </thead>
        <tbody>
            {% for mapping in mappings %}
                <tr>
                    <td>
                        <code>{{ mapping.indexFieldName }}</code>
                        <span class="si-role-chip" data-role="{{ mapping.role ?? '' }}" {% if mapping.role %}aria-label="{{ 'Role: {role}'|t('search-index', { role: mapping.role }) }}"{% endif %}>{{ mapping.role ?? '' }}</span>
                        {{ hiddenInput('mappings[' ~ mapping.uid ~ '][indexFieldName]', mapping.indexFieldName) }}
                        {{ hiddenInput('mappings[' ~ mapping.uid ~ '][enabled]', '1') }}
                        {{ hiddenInput('mappings[' ~ mapping.uid ~ '][weight]', mapping.weight) }}
                        {{ hiddenInput('mappings[' ~ mapping.uid ~ '][sortOrder]', mapping.sortOrder) }}
                    </td>
                    <td>
                        {{ forms.select({
                            name: 'mappings[' ~ mapping.uid ~ '][indexFieldType]',
                            value: mapping.indexFieldType,
                            options: fieldTypes,
                        }) }}
                    </td>
                    <td class="si-role-select">
                        {{ forms.select({
                            name: 'mappings[' ~ mapping.uid ~ '][role]',
                            value: mapping.role ?? '',
                            options: roleOptions,
                            class: 'si-role-input',
                        }) }}
                    </td>
                </tr>
            {% endfor %}
        </tbody>
    </table>
{% else %}
    <p class="zilch">{{ 'errors.noFieldsDetectedFromTheEngineSchemaMakeSureTheIndexExistsInTheEngineAndContainsDataThenUseTheRefreshFromSchemaButton'|t('search-index') }}</p>
{% endif %}

<div id="field-mappings-container"
    data-t-copied="{{ 'states.copiedToClipboard'|t('search-index') }}"
    data-t-copy-failed="{{ 'errors.failedToCopyToClipboard'|t('search-index') }}"
></div>

{{ searchIndexSprig('cp.validation-results', { indexId: index.id, run: false }, { id: 'validation-results', class: 'mt-l' }) }}
