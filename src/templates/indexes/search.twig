{% extends "search-index/_layouts/plugin" %}

{% set title = "Search"|t('search-index') %}
{% set selectedSubnavItem = 'search' %}

{% block content %}
    {% do view.registerAssetBundle("cogapp\\searchindex\\web\\assets\\searchpage\\SearchPageAsset") %}

    {% set embeddingFields = craft.searchIndex.getEmbeddingFieldsMap() %}

    <div id="search-page">
        {# Mode toggle #}
        <div class="btngroup mb-l" id="search-mode-toggle">
            <button type="button" class="btn active" data-mode="single">{{ "Single"|t('search-index') }}</button>
            <button type="button" class="btn" data-mode="compare">{{ "Compare"|t('search-index') }}</button>
        </div>

        {# Single mode #}
        <div id="single-mode">
            {{ sprig('search-index/_sprig/search-single', {
                indexOptions: indexOptions,
                embeddingFields: embeddingFields,
            }) }}
        </div>

        {# Compare mode #}
        <div id="compare-mode" class="hidden">
            {{ sprig('search-index/_sprig/search-compare', {
                indexOptions: indexOptions,
            }) }}
        </div>
    </div>

    {% js %}
        (function() {
            var btns = document.querySelectorAll('#search-mode-toggle .btn');
            var single = document.getElementById('single-mode');
            var compare = document.getElementById('compare-mode');
            btns.forEach(function(btn) {
                btn.addEventListener('click', function() {
                    btns.forEach(function(b) { b.classList.remove('active'); });
                    this.classList.add('active');
                    if (this.dataset.mode === 'single') {
                        single.classList.remove('hidden');
                        compare.classList.add('hidden');
                    } else {
                        single.classList.add('hidden');
                        compare.classList.remove('hidden');
                    }
                });
            });
        })();
    {% endjs %}
{% endblock %}
