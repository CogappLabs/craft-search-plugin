const M="http://www.w3.org/2000/svg";const o={top:10,right:15,bottom:40,left:55};function y(t){return t>=1e6?`${(t/1e6).toFixed(t%1e6===0?0:1)}M`:t>=1e3?`${(t/1e3).toFixed(t%1e3===0?0:1)}K`:String(t)}function S(t){if(t<=0)return[0];const n=t/4,c=10**Math.floor(Math.log10(n)),s=n/c;let e;s<=1?e=1:s<=2?e=2:s<=5?e=5:e=10;const d=e*c,r=[];for(let l=0;l<=t;l+=d)r.push(Math.round(l));return r[r.length-1]<t&&r.push(r[r.length-1]+Math.round(d)),r}function f(t,n){const c=document.createElementNS(M,t);for(const[s,e]of Object.entries(n))c.setAttribute(s,String(e));return c}function C(t,n){if(t.innerHTML="",t.setAttribute("viewBox","0 0 500 250"),t.setAttribute("preserveAspectRatio","xMidYMid meet"),!n.length)return;let c=Math.max(...n.map(i=>i.count));c<=0&&(c=1);const s=S(c),e=s[s.length-1]||1,d=500-o.left-o.right,r=250-o.top-o.bottom,l=Math.max(1,d/n.length-1);t.appendChild(f("line",{x1:o.left,y1:o.top,x2:o.left,y2:o.top+r,stroke:"#94a3b8","stroke-width":1})),t.appendChild(f("line",{x1:o.left,y1:o.top+r,x2:o.left+d,y2:o.top+r,stroke:"#94a3b8","stroke-width":1}));for(const i of s){const a=o.top+r-i/e*r;t.appendChild(f("line",{x1:o.left-4,y1:a,x2:o.left,y2:a,stroke:"#94a3b8","stroke-width":1})),t.appendChild(f("line",{x1:o.left,y1:a,x2:o.left+d,y2:a,stroke:"#e2e8f0","stroke-width":.5}));const h=f("text",{x:o.left-8,y:a+4,"text-anchor":"end","font-size":11,fill:"#64748b"});h.textContent=y(i),t.appendChild(h)}for(let i=0;i<n.length;i++){const a=n[i].count/e*r,h=o.left+i*(l+1),b=o.top+r-a,m=f("rect",{x:h,y:b,width:l,height:Math.max(a,0),fill:"#94a3b8",rx:1}),x=f("title",{});x.textContent=`${n[i].key}: ${n[i].count}`,m.appendChild(x),t.appendChild(m)}const u=Math.floor(d/40),g=Math.max(1,Math.ceil(n.length/u));for(let i=0;i<n.length;i+=g){const a=o.left+i*(l+1)+l/2,h=f("text",{x:a,y:o.top+r+16,"text-anchor":"middle","font-size":10,fill:"#64748b"});h.textContent=y(Number(n[i].key)),t.appendChild(h)}}function p(){const t=document.querySelectorAll(".si-histogram-trigger[data-histogram]:not([data-si-init])");for(const n of t){n.setAttribute("data-si-init","1");let c;try{c=JSON.parse(n.getAttribute("data-histogram")??"[]")}catch{continue}const s=n.getAttribute("data-dialog-id"),e=document.getElementById(s??"");if(!e)continue;const d=e.querySelector("svg");d&&C(d,c),n.addEventListener("click",()=>e.showModal()),e.querySelector(".si-histogram-close")?.addEventListener("click",()=>e.close()),e.addEventListener("click",u=>{u.target===e&&e.close()});const l=e.querySelector(".si-histogram-apply");l?.addEventListener("click",()=>{const u=e.querySelector(".si-histogram-min"),g=e.querySelector(".si-histogram-max"),i=document.getElementById(l.getAttribute("data-min-target")??""),a=document.getElementById(l.getAttribute("data-max-target")??""),h=document.getElementById(l.getAttribute("data-apply-target")??"");i&&u&&(i.value=u.value),a&&g&&(a.value=g.value),e.close(),h?.click()})}}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",p):p();document.addEventListener("htmx:afterSettle",p);
