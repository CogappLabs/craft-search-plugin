{# Ready-to-style starter page: one joined-up search experience. #}
{% set indexHandle = indexHandle ?? 'my_index' %}
{% set query = query ?? '' %}
{% set page = page ?? 1 %}
{% set perPage = perPage ?? 10 %}
{% set isDevMode = craft.app.config.general.devMode %}

{% set state = {
    indexHandle: indexHandle,
    query: query,
    doSearch: 1,
    page: page,
    perPage: perPage,
    sortField: '',
    sortDirection: 'desc',
    showRaw: 0,
    autoSearch: 1,
    hideSubmit: 1,
} %}

<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Search</title>
    <style>
        .htmx-indicator { display: none; }
        .htmx-request .htmx-indicator,
        .htmx-request.htmx-indicator { display: inline; }
        .search-page .si-default-search-form > button[type='submit'] { display: none; }
        .si-default-results { list-style: none; margin: 1rem 0; padding: 0; display: grid; gap: 1rem; grid-template-columns: repeat(auto-fit, minmax(220px, 1fr)); }
        .si-default-result-card { border: 1px solid #ddd; border-radius: 6px; padding: 0.75rem; }
        .si-default-card-img { margin-bottom: 0.5rem; }
        .si-default-card-img img { display: block; max-width: 100%; height: auto; }
    </style>
    {{ head() }}
</head>
<body>
{{ beginBody() }}
<main class="search-page">
    <h1>Search</h1>
    {% include 'search-index/sprig/components/search-box' with { state: state } %}

    {% if isDevMode %}
        <details>
            <summary>Twig helper examples (dev only)</summary>
            <pre><code>{{ "{{ searchIndexSprig('frontend.search-box', state) }}"|replace({'&':'&amp;','<':'&lt;','>':'&gt;'})|raw }}</code></pre>
            <pre><code>{{ "{{ craft.searchIndex.buildUrl('/search', { q: query, page: 2 }) }}"|replace({'&':'&amp;','<':'&lt;','>':'&gt;'})|raw }}</code></pre>
            <pre><code>{{ "{{ craft.searchIndex.stateInputs({ q: query, page: page, region: activeRegions }, { exclude: 'q' }) }}"|replace({'&':'&amp;','<':'&lt;','>':'&gt;'})|raw }}</code></pre>
            <pre><code>{{ "{% set searchDoc = entry.mySearchDocField %}\n{% set image = searchDoc ? searchDoc.getImage() : null %}\n{% if image %}\n  <img src=\"{{ image.getUrl({ width: 480 }) }}\" alt=\"{{ image.alt ?? searchDoc.getTitle() }}\">\n{% endif %}"|replace({'&':'&amp;','<':'&lt;','>':'&gt;'})|raw }}</code></pre>
        </details>
    {% endif %}
</main>
{{ endBody() }}
</body>
</html>
