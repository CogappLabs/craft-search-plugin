(()=>{const a=document.getElementById("search-index-edit-form");if(!a)return;const m=a.dataset.isNew==="true",s=document.getElementById("engineType");s&&s.addEventListener("change",function(){document.querySelectorAll(".engine-config-fields").forEach(t=>{t.style.display="none"});const e=document.querySelector(`.engine-config-fields[data-engine="${this.value}"]`);e&&(e.style.display="")});const d=document.getElementById("name"),o=document.getElementById("handle");let l=!m;d&&o&&(d.addEventListener("input",function(){l||(o.value=this.value.toLowerCase().replace(/[^a-z0-9]+/g,"_").replace(/^_|_$/g,""))}),o.addEventListener("input",()=>{l=!0}));const c=document.getElementById("test-connection-btn");c&&s&&c.addEventListener("click",function(){const e=document.getElementById("test-connection-result");if(!e)return;this.classList.add("loading"),e.textContent="",e.className="ml-s";const t=s.value;if(!t){this.classList.remove("loading"),e.textContent="Please select an engine first.",e.classList.add("error");return}const f=document.querySelectorAll(`.engine-config-fields[data-engine="${t}"] input`),u={};f.forEach(n=>{const g=n.name.match(/engineConfig\[(.+)\]/);g&&(u[g[1]]=n.value)}),Craft.sendActionRequest("POST","search-index/indexes/test-connection",{data:{engineType:t,engineConfig:u}}).then(n=>{c.classList.remove("loading"),e.textContent=n.data.message,n.data.success?e.classList.add("success"):e.classList.add("error")}).catch(()=>{c.classList.remove("loading"),e.textContent="Request failed.",e.classList.add("error")})}),document.querySelectorAll('#sectionIds input[type="checkbox"]').forEach(e=>{e.addEventListener("change",function(){document.querySelectorAll(`.entry-type-checkbox[data-section="${this.value}"]`).forEach(t=>{t.style.display=e.checked?"":"none"})})});const i=document.getElementById("mode"),r=document.getElementById("synced-sources");if(i&&r){let e=function(){r.style.display=i.value==="readonly"?"none":""};i.addEventListener("change",e),e()}})();
