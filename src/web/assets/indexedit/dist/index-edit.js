(()=>{const g=document.getElementById("search-index-edit-form");if(!g)return;const L=g.dataset.isNew==="true",n=document.getElementById("engineType");function m(e){document.querySelectorAll(".engine-config-fields").forEach(t=>{const o=t.dataset.engine===e;t.classList.toggle("hidden",!o),t.querySelectorAll("input").forEach(i=>{i.disabled=!o})})}n&&(m(n.value),n.addEventListener("change",function(){m(this.value);const e=document.querySelector(`.engine-config-fields[data-engine="${CSS.escape(this.value)}"]`);e&&Craft.initUiElements(e)}));const f=document.getElementById("name"),a=document.getElementById("handle");let h=!L;f&&a&&(f.addEventListener("input",function(){h||(a.value=this.value.toLowerCase().replace(/[^a-z0-9]+/g,"_").replace(/^_|_$/g,""))}),a.addEventListener("input",()=>{h=!0}));const c=document.getElementById("test-connection-btn"),l=document.getElementById("test-connection"),d={selectEngine:l?.dataset.tSelectEngine||"Please select an engine first.",timeout:l?.dataset.tTimeout||"Connection timed out after 5 seconds.",requestFailed:l?.dataset.tRequestFailed||"Request failed."};c&&n&&c.addEventListener("click",function(){const e=document.getElementById("test-connection-result");if(!e)return;this.classList.add("loading"),e.textContent="",e.className="ml-s";const t=n.value;if(!t){this.classList.remove("loading"),e.textContent=d.selectEngine,e.classList.add("error");return}const o=document.querySelectorAll(`.engine-config-fields[data-engine="${CSS.escape(t)}"] input`),i={};o.forEach(s=>{const v=s.name.match(/engineConfig\[(.+)\]/);v&&(i[v[1]]=s.value)});const u=new AbortController,y=setTimeout(()=>u.abort(),5e3);Craft.sendActionRequest("POST","search-index/indexes/test-connection",{data:{engineType:t,engineConfig:i},signal:u.signal}).then(s=>{clearTimeout(y),c.classList.remove("loading"),e.textContent=s.data.message,s.data.success?e.classList.add("success"):e.classList.add("error")}).catch(()=>{clearTimeout(y),c.classList.remove("loading"),e.textContent=u.signal.aborted?d.timeout:d.requestFailed,e.classList.add("error")})}),document.querySelectorAll('#sectionIds input[type="checkbox"]').forEach(e=>{e.addEventListener("change",function(){document.querySelectorAll(`.entry-type-checkbox[data-section="${this.value}"]`).forEach(t=>{t.classList.toggle("hidden",!e.checked)})})});const r=document.getElementById("mode"),E=document.getElementById("synced-sources");if(r&&E){let e=function(){E.classList.toggle("hidden",r.value==="readonly")};r.addEventListener("change",e),e()}})();
