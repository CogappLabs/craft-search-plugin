(()=>{document.querySelectorAll(".search-document-field[data-field-id]").forEach(U);function U(n){const y=n.querySelector(".sdf-document-id"),v=n.querySelector(".sdf-section-handle"),E=n.querySelector(".sdf-entry-type-handle"),H=n.querySelector(".sdf-query"),A=n.querySelector(".sdf-results"),S=n.querySelector(".sdf-results-list"),b=n.querySelector(".sdf-selected"),g=n.querySelector(".sdf-selected-title"),L=n.querySelector(".sdf-search"),C=n.querySelector(".sdf-clear"),_=n.querySelector(".sdf-index-handle");if(!y||!v||!E||!H||!A||!S||!b||!g||!L||!C||!_)return;const B=_,q=y,D=v,T=E,c=H,I=A,i=S,x=b,k=g,u=L,O=n.dataset.tNoResults||"No results found.",G=n.dataset.tSearchFailed||"Search failed.";let R,s=-1,r=[],f=null;const V=parseInt(n.dataset.perPage||String(10),10)||10;c.addEventListener("input",function(){clearTimeout(R);const t=this.value.trim();if(t.length<1){h();return}R=setTimeout(()=>z(t),300)}),c.addEventListener("keydown",t=>{if(!(!r.length&&t.key!=="Escape"))switch(t.key){case"ArrowDown":t.preventDefault(),P(s<r.length-1?s+1:0);break;case"ArrowUp":t.preventDefault(),P(s>0?s-1:r.length-1);break;case"Enter":if(t.preventDefault(),s>=0&&s<r.length){const e=r[s];w(e.objectID||"",e.title||e.name||e.objectID||"",e.uri||"",e.sectionHandle||"",e.entryTypeHandle||"")}break;case"Escape":t.preventDefault(),h();break}});function P(t){s=t;const e=i.querySelectorAll(".sdf-result-item");e.forEach((a,o)=>{a.classList.toggle("sdf-active",o===s)}),s>=0&&e[s]?(c.setAttribute("aria-activedescendant",e[s].id),e[s].scrollIntoView({block:"nearest"})):c.removeAttribute("aria-activedescendant")}function $(){I.classList.remove("hidden"),c.setAttribute("aria-expanded","true")}function h(){I.classList.add("hidden"),c.setAttribute("aria-expanded","false"),c.removeAttribute("aria-activedescendant"),s=-1,r=[]}function z(t){f&&f.abort(),f=new AbortController,u.classList.add("sdf-loading"),Craft.sendActionRequest("POST","search-index/search/search",{data:{indexHandle:B.value,query:t,perPage:V},signal:f.signal}).then(e=>{const{data:a}=e;if(i.innerHTML="",s=-1,r=[],!a.success||!a.hits||a.hits.length===0){i.innerHTML=`<li class="sdf-no-results"><em>${Craft.escapeHtml(O)}</em></li>`,$();return}r=a.hits;const o=i.id;a.hits.forEach((l,p)=>{const d=document.createElement("li");d.className="sdf-result-item",d.id=`${o}-option-${p}`,d.setAttribute("role","option");const M=l.title||l.name||l.objectID||"",m=l.uri||"",j=l.sectionHandle||"",F=l.entryTypeHandle||"",N=[j,F].filter(Boolean).join(" / ");d.innerHTML=`<strong>${Craft.escapeHtml(M)}</strong>`+(N?` <span class="light">— ${Craft.escapeHtml(N)}</span>`:"")+(m?`<br><small class="light">${Craft.escapeHtml(m)}</small>`:""),d.addEventListener("click",()=>{w(l.objectID,M,m,j,F)}),i.appendChild(d)}),$()}).catch(e=>{e instanceof DOMException&&e.name==="AbortError"||Craft.cp.displayError(G)}).finally(()=>{u.classList.remove("sdf-loading")})}function w(t,e,a,o="",l=""){q.value=t,D.value=o,T.value=l;const p=[o,l].filter(Boolean).join(" / ");k.innerHTML=Craft.escapeHtml(e)+(p?` <span class="light">— ${Craft.escapeHtml(p)}</span>`:"")+(a?` <span class="light">— ${Craft.escapeHtml(a)}</span>`:"")+` <span class="light">(ID: ${Craft.escapeHtml(t)})</span>`,x.classList.remove("hidden"),u.classList.add("hidden"),h(),c.value="",i.innerHTML=""}C.addEventListener("click",()=>{q.value="",D.value="",T.value="",x.classList.add("hidden"),u.classList.remove("hidden"),k.textContent="",c.focus()})}})();
