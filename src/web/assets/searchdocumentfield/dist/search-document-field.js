document.body.addEventListener("htmx:configRequest",t=>{const e=t.detail?.elt;if(!e?.classList.contains("sdf-query"))return;const s=t.detail.parameters;s.query=e.value});document.body.addEventListener("htmx:afterSettle",t=>{const e=t.detail?.target;if(!e)return;const s=e.classList.contains("sdf-sprig-root")?e:e.querySelector(".sdf-sprig-root");if(!s)return;const r=s.closest(".search-document-field");if(!r)return;const a={documentId:s.dataset.documentId??"",sectionHandle:s.dataset.sectionHandle??"",entryTypeHandle:s.dataset.entryTypeHandle??""};for(const[c,l]of Object.entries(a)){const o=r.querySelector(`[data-sdf-field="${c}"]`);o&&(o.value=l)}const n=s.querySelector(".sdf-query");if(n&&document.activeElement!==n){n.focus();const c=n.value.length;n.selectionStart=c,n.selectionEnd=c}});document.body.addEventListener("keydown",t=>{const e=t.target;if(!e.classList.contains("sdf-query"))return;const s=e.closest(".search-document-field");if(!s)return;const r=s.querySelectorAll(".sdf-result-item");if(!r.length&&t.key!=="Escape")return;let a=-1;switch(r.forEach((n,c)=>{n.classList.contains("sdf-active")&&(a=c)}),t.key){case"ArrowDown":t.preventDefault(),i(r,a<r.length-1?a+1:0,e);break;case"ArrowUp":t.preventDefault(),i(r,a>0?a-1:r.length-1,e);break;case"Enter":t.preventDefault(),a>=0&&a<r.length&&r[a].querySelector(".sdf-result-btn")?.click();break;case"Escape":t.preventDefault(),s.querySelector(".sdf-results")?.classList.add("hidden"),r.forEach(n=>{n.classList.remove("sdf-active")}),e.removeAttribute("aria-activedescendant");break}});function i(t,e,s){t.forEach((r,a)=>{r.classList.toggle("sdf-active",a===e)}),e>=0&&t[e]?(s.setAttribute("aria-activedescendant",t[e].id),t[e].scrollIntoView({block:"nearest"})):s.removeAttribute("aria-activedescendant")}
