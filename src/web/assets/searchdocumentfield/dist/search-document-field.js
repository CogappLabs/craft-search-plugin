(()=>{document.querySelectorAll(".search-document-field[data-field-id]").forEach(O);function O(s){const E=s.querySelector(".sdf-index-handle"),A=s.querySelector(".sdf-document-id"),C=s.querySelector(".sdf-section-handle"),S=s.querySelector(".sdf-entry-type-handle"),g=s.querySelector(".sdf-query"),b=s.querySelector(".sdf-results"),L=s.querySelector(".sdf-results-list"),T=s.querySelector(".sdf-selected"),_=s.querySelector(".sdf-selected-title"),q=s.querySelector(".sdf-search"),D=s.querySelector(".sdf-clear");if(!E||!A||!C||!S||!g||!b||!L||!T||!_||!q||!D)return;const I=E,o=A,x=C,R=S,r=g,k=b,i=L,P=T,p=_,m=q,G=s.dataset.tSearchFailed||"Search failed.",V=s.dataset.tNoResults||"No results found.",$=s.dataset.tNotFound||"Document {id} (not found)";let w,n=-1,d=[],h=null;const z=parseInt(s.dataset.perPage||String(10),10)||10;r.addEventListener("input",function(){clearTimeout(w);const t=this.value.trim();if(t.length<1){v();return}w=setTimeout(()=>J(t),300)}),r.addEventListener("keydown",t=>{if(!(!d.length&&t.key!=="Escape"))switch(t.key){case"ArrowDown":t.preventDefault(),F(n<d.length-1?n+1:0);break;case"ArrowUp":t.preventDefault(),F(n>0?n-1:d.length-1);break;case"Enter":if(t.preventDefault(),n>=0&&n<d.length){const e=d[n],a=e.title||e.name||e.objectID||"",c=e.uri||"";y(e.objectID,a,c,e.sectionHandle||"",e.entryTypeHandle||"")}break;case"Escape":t.preventDefault(),v();break}});function F(t){n=t;const e=i.querySelectorAll(".sdf-result-item");e.forEach((a,c)=>{a.classList.toggle("sdf-active",c===n)}),n>=0&&e[n]?(r.setAttribute("aria-activedescendant",e[n].id),e[n].scrollIntoView({block:"nearest"})):r.removeAttribute("aria-activedescendant")}function M(){k.classList.remove("hidden"),r.setAttribute("aria-expanded","true")}function v(){k.classList.add("hidden"),r.setAttribute("aria-expanded","false"),r.removeAttribute("aria-activedescendant"),n=-1,d=[]}function J(t){h&&h.abort(),h=new AbortController,m.classList.add("sdf-loading"),Craft.sendActionRequest("POST","search-index/search/search",{data:{indexHandle:I.value,query:t,perPage:z},signal:h.signal}).then(e=>{const{data:a}=e;if(i.innerHTML="",n=-1,d=[],!a.success||!a.hits||a.hits.length===0){i.innerHTML=`<li class="sdf-no-results"><em>${Craft.escapeHtml(V)}</em></li>`,M();return}d=a.hits;const c=i.id;a.hits.forEach((l,u)=>{const f=document.createElement("li");f.className="sdf-result-item",f.id=`${c}-option-${u}`,f.setAttribute("role","option");const N=l.title||l.name||l.objectID||"",H=l.uri||"",j=l.sectionHandle||"",U=l.entryTypeHandle||"",B=[j,U].filter(Boolean).join(" / ");f.innerHTML=`<strong>${Craft.escapeHtml(N)}</strong>`+(B?` <span class="light">— ${Craft.escapeHtml(B)}</span>`:"")+(H?`<br><small class="light">${Craft.escapeHtml(H)}</small>`:""),f.addEventListener("click",()=>{y(l.objectID,N,H,j,U)}),i.appendChild(f)}),M()}).catch(e=>{e instanceof DOMException&&e.name==="AbortError"||Craft.cp.displayError(G)}).finally(()=>{m.classList.remove("sdf-loading")})}function y(t,e,a,c="",l=""){o.value=t,x.value=c,R.value=l;const u=[c,l].filter(Boolean).join(" / ");p.innerHTML=Craft.escapeHtml(e)+(u?` <span class="light">— ${Craft.escapeHtml(u)}</span>`:"")+(a?` <span class="light">— ${Craft.escapeHtml(a)}</span>`:"")+` <span class="light">(ID: ${Craft.escapeHtml(t)})</span>`,P.classList.remove("hidden"),m.classList.add("hidden"),v(),r.value="",i.innerHTML=""}D.addEventListener("click",()=>{o.value="",x.value="",R.value="",P.classList.add("hidden"),m.classList.remove("hidden"),p.textContent="",r.focus()}),o.value&&Craft.sendActionRequest("POST","search-index/search/get-document",{data:{indexHandle:I.value,documentId:o.value}}).then(t=>{const{data:e}=t;if(e.success&&e.document){const a=e.document.title||e.document.name||o.value,c=e.document.uri||"",l=e.document.sectionHandle||"",u=e.document.entryTypeHandle||"";y(o.value,a,c,l,u)}else p.textContent=$.replace("{id}",o.value)}).catch(()=>{p.textContent=$.replace("{id}",o.value)})}})();
