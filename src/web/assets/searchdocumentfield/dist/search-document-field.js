(()=>{document.querySelectorAll(".search-document-field[data-field-id]").forEach(q);function q(e){const f=e.querySelector(".sdf-index-handle"),n=e.querySelector(".sdf-document-id"),y=e.querySelector(".sdf-query"),o=e.querySelector(".sdf-results"),u=e.querySelector(".sdf-results-list"),m=e.querySelector(".sdf-selected"),a=e.querySelector(".sdf-selected-title"),p=e.querySelector(".sdf-search"),x=e.querySelector(".sdf-clear");let h;const C=parseInt(e.dataset.perPage||"10",10)||10;y.addEventListener("input",function(){clearTimeout(h);const t=this.value.trim();if(t.length<1){o.style.display="none";return}h=setTimeout(()=>S(t),300)});function S(t){Craft.sendActionRequest("POST","search-index/search/search",{data:{indexHandle:f.value,query:t,perPage:C}}).then(c=>{const s=c.data;u.innerHTML="";const d=s.hits;if(!s.success||!d||d.length===0){u.innerHTML='<li class="sdf-no-results"><em>No results found.</em></li>',o.style.display="";return}d.forEach(l=>{const r=document.createElement("li");r.className="sdf-result-item",r.style.cssText="padding:6px 10px;cursor:pointer;border-bottom:1px solid var(--gray-200)";const v=l.title||l.name||l.objectID,i=l.uri||"";r.innerHTML=`<strong>${Craft.escapeHtml(v)}</strong>`+(i?`<br><small class="light">${Craft.escapeHtml(i)}</small>`:""),r.addEventListener("click",()=>{T(l.objectID,v,i)}),u.appendChild(r)}),o.style.display=""}).catch(()=>{Craft.cp.displayError("Search failed.")})}function T(t,c,s){n.value=t,a.textContent=`${c+(s?` — ${s}`:"")} (ID: ${t})`,m.style.display="",p.style.display="none",o.style.display="none",y.value="",u.innerHTML=""}x.addEventListener("click",()=>{n.value="",m.style.display="none",p.style.display="",a.textContent=""}),n.value&&Craft.sendActionRequest("POST","search-index/search/get-document",{data:{indexHandle:f.value,documentId:n.value}}).then(t=>{const c=t.data;if(c.success&&c.document){const s=c.document,d=s.title||s.name||n.value,l=s.uri||"";a.textContent=`${d+(l?` — ${l}`:"")} (ID: ${n.value})`}else a.textContent=`Document ${n.value} (not found)`}).catch(()=>{a.textContent=`Document ${n.value}`})}})();
