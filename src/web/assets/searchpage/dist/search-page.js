(()=>{const o=document.getElementById("search-page");if(!o)return;const l={searchFailed:o.dataset.tSearchFailed||"Search failed.",noResults:o.dataset.tNoResults||"No results found.",enterQuery:o.dataset.tEnterQuery||"Please enter a search query.",selectIndex:o.dataset.tSelectIndex||"Select at least one index to compare.",resultsSummary:o.dataset.tResultsSummary||"{total} results in {time}ms (page {page} of {pages})",compareSummary:o.dataset.tCompareSummary||"{total} results in {time}ms",noCompareResults:o.dataset.tNoCompareResults||"No results.",rawResponse:o.dataset.tRawResponse||"Raw engine response"},S=document.querySelectorAll("#search-page .btngroup .btn"),f=document.getElementById("single-mode"),y=document.getElementById("compare-mode");f&&y&&S.forEach(e=>{e.addEventListener("click",function(){for(const n of S)n.classList.remove("active");this.classList.add("active"),this.dataset.mode==="single"?(f.classList.remove("hidden"),y.classList.add("hidden")):(f.classList.add("hidden"),y.classList.remove("hidden"))})});const H=JSON.parse(o.dataset.embeddingFields||"{}"),u=document.getElementById("single-search-btn"),d=document.getElementById("single-index"),b=document.getElementById("single-query"),v=document.getElementById("single-perpage"),m=document.getElementById("single-results"),I=document.getElementById("single-search-mode-field"),p=document.getElementById("single-search-mode"),L=document.getElementById("single-embedding-field-field"),h=document.getElementById("single-embedding-field");function x(){if(!d||!I||!p)return;const e=d.value,n=H[e]||[],t=n.length>0;I.classList.toggle("hidden",!t),t||(p.value="text"),$(n)}function $(e){if(!d||!p||!L||!h)return;const n=d.value,t=e??H[n]??[],r=p.value!=="text"&&t.length>1;L.classList.toggle("hidden",!r),h.innerHTML="";for(const s of t){const c=document.createElement("option");c.value=s,c.textContent=s,h.appendChild(c)}}d&&(d.addEventListener("change",()=>x()),x()),p&&p.addEventListener("change",()=>$()),u&&d&&b&&v&&(u.addEventListener("click",()=>{const e=d.value,n=b.value.trim(),t=parseInt(v.value,10)||20,a=p?.value||"text",r=h?.value||"";if(!n){Craft.cp.displayError(l.enterQuery);return}u.classList.add("loading");const s={indexHandle:e,query:n,perPage:t};a!=="text"&&(s.searchMode=a,r&&(s.embeddingField=r)),Craft.sendActionRequest("POST","search-index/search/search",{data:s}).then(c=>{u.classList.remove("loading"),B(c.data)}).catch(()=>{u.classList.remove("loading"),Craft.cp.displayError(l.searchFailed)})}),b.addEventListener("keydown",e=>{e.key==="Enter"&&(e.preventDefault(),u.click())}));function B(e){if(!m)return;if(!e.success){m.innerHTML=`<p class="error">${Craft.escapeHtml(e.message||l.searchFailed)}</p>`;return}if(!e.hits||e.hits.length===0){m.innerHTML=`<p class="zilch">${Craft.escapeHtml(l.noResults)}</p>`;return}const n=l.resultsSummary.replace("{total}",String(e.totalHits)).replace("{time}",String(e.processingTimeMs)).replace("{page}",String(e.page)).replace("{pages}",String(e.totalPages));let t=`<p class="light mb-s">${Craft.escapeHtml(n)}</p>`;t+='<table class="data fullwidth"><thead><tr><th>Title</th><th>URI</th><th>Score</th><th>Object ID</th><th></th></tr></thead><tbody>',e.hits.forEach((a,r)=>{const s=a.title||a.name||"-",c=a.uri||"-",i=a._score!==null&&a._score!==void 0?String(a._score):"-",M=a.objectID||"-";t+=`<tr><td>${Craft.escapeHtml(s)}</td><td>${Craft.escapeHtml(c)}</td><td>${Craft.escapeHtml(i)}</td><td><code>${Craft.escapeHtml(M)}</code></td><td class="thin"><button type="button" class="btn small toggle-raw" data-index="${r}">JSON</button></td></tr><tr class="raw-row hidden" data-index="${r}"><td colspan="5"><pre class="code si-code-block si-raw-json">${Craft.escapeHtml(JSON.stringify(a,null,2))}</pre></td></tr>`}),t+="</tbody></table>",e.raw&&(t+=`<details class="mt-s"><summary>${Craft.escapeHtml(l.rawResponse)}</summary><pre class="code si-code-block si-raw-response">${Craft.escapeHtml(JSON.stringify(e.raw,null,2))}</pre></details>`),m.innerHTML=t}m&&m.addEventListener("click",e=>{const n=e.target.closest(".toggle-raw");if(!n)return;const t=n.dataset.index;if(!t)return;const a=m.querySelector(`.raw-row[data-index="${t}"]`);a&&a.classList.toggle("hidden")});const g=document.getElementById("compare-search-btn"),E=document.getElementById("compare-query"),w=document.getElementById("compare-perpage"),C=document.getElementById("compare-results");g&&E&&w&&(g.addEventListener("click",()=>{const e=document.querySelectorAll('#compare-indexes input[type="checkbox"]:checked'),n=E.value.trim(),t=parseInt(w.value,10)||20;if(e.length===0){Craft.cp.displayError(l.selectIndex);return}if(!n){Craft.cp.displayError(l.enterQuery);return}if(!C)return;g.classList.add("loading"),C.innerHTML="";const a=[];e.forEach(s=>{const c=s.value,i=document.createElement("div");i.className="si-compare-panel",i.innerHTML=`<h3>${Craft.escapeHtml(c)}</h3><p class="spinner"></p>`,C.appendChild(i),a.push({handle:c,panel:i})});const r=a.map(({handle:s,panel:c})=>Craft.sendActionRequest("POST","search-index/search/search",{data:{indexHandle:s,query:n,perPage:t}}).then(i=>{R(c,s,i.data)}).catch(()=>{c.innerHTML=`<h3>${Craft.escapeHtml(s)}</h3><p class="error">${Craft.escapeHtml(l.searchFailed)}</p>`}));Promise.allSettled(r).then(()=>{g.classList.remove("loading")})}),E.addEventListener("keydown",e=>{e.key==="Enter"&&(e.preventDefault(),g.click())}));function R(e,n,t){if(!t.success){e.innerHTML=`<h3>${Craft.escapeHtml(n)}</h3><p class="error">${Craft.escapeHtml(t.message||l.searchFailed)}</p>`;return}const a=l.compareSummary.replace("{total}",String(t.totalHits)).replace("{time}",String(t.processingTimeMs));let r=`<h3>${Craft.escapeHtml(n)}</h3><p class="light mb-xs">${Craft.escapeHtml(a)}</p>`;!t.hits||t.hits.length===0?r+=`<p class="zilch">${Craft.escapeHtml(l.noCompareResults)}</p>`:(r+='<table class="data fullwidth"><thead><tr><th>Title</th><th>Score</th><th>ID</th></tr></thead><tbody>',t.hits.forEach(s=>{const c=s.title||s.name||"-",i=s._score!==null&&s._score!==void 0?String(s._score):"-";r+=`<tr><td>${Craft.escapeHtml(c)}</td><td>${Craft.escapeHtml(i)}</td><td><code>${Craft.escapeHtml(s.objectID||"-")}</code></td></tr>`}),r+="</tbody></table>"),t.raw&&(r+=`<details class="mt-xs"><summary>${Craft.escapeHtml(l.rawResponse)}</summary><pre class="code si-code-block si-raw-json">${Craft.escapeHtml(JSON.stringify(t.raw,null,2))}</pre></details>`),e.innerHTML=r}})();
